$(document).ready((function(){let t=new class{constructor(t){this.imageUrl=t,this.scaleFactor=2,this.init()}init(){this.image=new Image,this.image.src=this.imageUrl,this.canvas=document.getElementsByClassName("canvas")[0],this.context=this.canvas.getContext("2d"),this.context.scale(this.scaleFactor,this.scaleFactor),this.image.onload=()=>{this.context.drawImage(this.image,0,0),this.imageRatio=this.image.naturalHeight/this.image.naturalWidth,this.draw(),localStorage.getItem("startTimestamp")&&(e.resumeMarker(),$("#button-start").val("Reset").addClass("stop"),$(".start-time-container").css("display","none"),$("#seperator").addClass("fade"))}}draw(){this.canvas.width=window.innerWidth*this.scaleFactor,this.canvas.height=this.canvas.width*this.imageRatio,this.context.drawImage(this.image,0,0,this.canvas.width,this.canvas.height)}setImage(t){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.imageUrl=t,this.init()}}("./assets/duration_chart_2cb.png");const e=new class{constructor(t,e){this.context=t,this.canvas=e,this.stopped=!0}draw(t){this.context.beginPath(),this.context.moveTo(t,.053*this.canvas.height),this.context.lineTo(t,.84*this.canvas.height),this.context.lineWidth=Math.ceil(this.canvas.width/300),this.context.strokeStyle="rgb(96, 0, 206)",this.context.stroke()}restartMarker(){clearInterval(this.interval),this.setStartTimestamp(),this.resumeMarker()}resumeMarker(){this.stopped=!1,i(),this.interval=setInterval((()=>i()),3e3)}removeMarker(){clearInterval(this.interval),this.stopped=!0}updateMarkerPosition(){let t=(this.getCurrentTimestamp()-this.getStartTimestamp())/60;a.setText(t),t>740&&(t=740);let e=.075*this.canvas.width+t*(.00125*this.canvas.width);this.draw(e)}setStartTimestamp(){let t=this.getCurrentTimestamp()-a.getStartedSecondsAgo();localStorage.setItem("startTimestamp",t)}getStartTimestamp(){return localStorage.getItem("startTimestamp")}getCurrentTimestamp(){return Math.floor(Date.now()/1e3)}}(t.context,t.canvas),a=new class{constructor(){this.container=$(".start-time-container"),this.element=$("#starttime")}disableInput(){this.container.fadeOut(2e3)}enableInput(){this.container.fadeIn(2e3)}getStartedSecondsAgo(){return 60*$("#starttime").val()}setText(t){let e=Math.trunc(t),a=e%60,s=(e-a)/60;$("#timer #hh").text((s<10?"0":"")+s.toString()),$("#timer #mm").text((a<10?"0":"")+a.toString())}};let s;function i(){t.draw(),e.stopped||e.updateMarkerPosition()}function r(){$("#substance_info").attr("href","https://psychonautwiki.org/wiki/"+$("#substances").val())}$(window).on("resize",(function(){clearTimeout(s),s=setTimeout(i,100)})),$("#button-start").click((function(){if("Start"==$(this).val())e.restartMarker(),a.disableInput(),$(this).val("Reset").addClass("stop"),$("#seperator").addClass("fade");else{if(!window.confirm("Do you really want to reset your timer?"))return;$(this).val("Start").removeClass("stop"),$("#seperator").removeClass("fade"),a.setText(0),e.removeMarker(),t.draw(),localStorage.removeItem("startTimestamp"),a.enableInput()}})),$("#substances").on("change",(function(){t.setImage("./assets/duration_chart_"+this.value+".png"),localStorage.substance=this.value,r()})),r(),localStorage.substance&&$("#substances").val(localStorage.substance).trigger("change"),setTimeout((function(){$("#title span").animate({opacity:0},1e3,(function(){$(this).text("To use your head, you have to go out of your mind.").addClass("quote")})).animate({opacity:1},1e3)}),15e3)}));